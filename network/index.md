# 网络通信

## 如何建立多台主机互连

```
在一个局域网内

主机A -> 交换机 <- 主机B
```

- 如何定位局域网中的其他主机？

  > mac 地址来唯一标识一台主机

- (ip 地址)
  > 数据发送时 原 mac、原 ip、目标 mac、目标 ip。发送到路由器，然后路由器识别当前要找的主机在不在局域网内，不在的话去寻找路由表的信息去帮助网络路由找到相应网络然后发送。然后由那边的交换机去完成最后的定位功能

## 网络层次模型 (OSI 七层模型，TCP/IP 四层/五层模型)

### OSI

- 应用层: 用户与网络的接口

- 表示层: 数据加密、转换、压缩

- 会话层: 控制网络连接建立与终止

- 传输层：控制数据传输可靠性

- 网络层：确定目标网络

- 数据链路：确定目标主机

- 物理层：各种物理设备和标准

> 数据从 A 至 B，先封装再解封

### 数据封装和解封装 (TCP/IP 五层模型)

```
发送：
应用层：data。(http)
传输层：将数据可靠的传输到相应的端口（TCP/UDP协议）。数据被包裹成：目标端口 + 源端口 + data。(TCP、UDP)
网络层：通过IP协议确定目标的IP地址，只能确定网络，并不能确定哪台机子是我们想传送的。被包裹成：目标IP + 源IP + 目标端口 + 源端口 + data。
数据链路层：这里可以包裹mac地址，确保哪台机子是我们想传送的。被包裹成：目标MAC + 源MAC + 目标IP + 源IP + 目标端口 + 源端口 + data。
物理层：网线，网卡调制转换为二进制信号，然后传输介质运输给目标。

接收：各个层级通过解包，判断目标是否和自己一样。一层一层往下解包
应用
传输
网络
数据链路
物理层
```

```
数据封包：data，获取二进制数据包

[消息头，消息体]
[序列号，消息长度，消息体]
```

## TCP协议

- 传输层协议

```
TCP 报文：
32位
16位源端口号、16位目标端口号
32位序列号
32位确认号

常见控制字段：
SYN = 1 表示请求建立连接
FIN = 1 表示请求断开连接
ACK = 1 表示数据信息确认

TCP三次握手：(双向通道)
client              server
        SYN = 1 ->
        <- ACK = 1 SYN = 1 (这里SYN = 1 代表服务端想给客户端发送消息，即建立连接)
        ACK = 1 ->
```

- 面向连接的协议

- 用于处理实时通信

### tcp粘包

- 接收端没有及时读取缓冲区的数据，会发生粘包（发送端多次发送的数据，最终会在缓冲区中黏在一起）

```
解决：
1. 发送端设置sleep，每隔多少时间发送一次包
2. 接收端将包封装成固定长度格式的数据，然后接收数据时根据长度去循环拆包(包头、包体)
```

### HTTP

- 客户端代理